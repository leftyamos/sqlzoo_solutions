Helpdesk Easy Questions

1. There are three issues that include the words "index" and "Oracle". Find the 
call_date for each of them:

SELECT DATE_FORMAT(call_date, '%Y-%m-%d %T'), call_ref FROM Issue
WHERE detail LIKE '%index%' AND 
      detail LIKE '%Oracle%';


2. Samantha Hall made three calls on 2017-08-14. Show the date and time for each:

SELECT DATE_FORMAT(call_date, '%Y-%m-%d %T'),
       first_name,
       last_name
FROM Issue
JOIN Caller
 ON Issue.caller_id = Caller.caller_id
WHERE first_name = 'Samantha' AND
      last_name = 'Hall' AND
      DATE(call_date) = '2017-08-14';


3. There are 500 calls in the system (roughly). Write a query that shows the number 
that have each status:

SELECT status, COUNT(status) AS volume FROM Issue
GROUP BY status;


4. Calls are not normally assigned to a manager but it does happen. How many calls 
have been assigned to staff who are at Manager Level?:

SELECT COUNT(*) FROM Issue
JOIN Staff
 ON Issue.assigned_to = Staff.staff_code
WHERE level_code IN (SELECT level_code FROM Level
                     WHERE manager IS NOT NULL);


5. Show the manager for each shift. Your output should include the shift date 
and type; also the first and last name of the manager:

SELECT DATE_FORMAT(shift_date, '%Y-%m-%d'), shift_type,
       first_name, last_name 
FROM Staff
JOIN Shift
 ON Staff.staff_code = Shift.manager
ORDER BY shift_date;


-----------------------------------------------------------------------------------------
Helpdesk Medium Questions

6. List the Company name and the number of calls for those companies with more 
than 18 calls:

select company_name, COUNT(*) 
FROM Issue
JOIN Caller
 ON Issue.caller_id = Caller.caller_id
JOIN Customer
 ON Caller.company_ref = Customer.company_ref
GROUP BY company_name
HAVING COUNT(*) > 18;


7. Find the callers who have never made a call. Show first name and last name:

SELECT first_name, last_name FROM Caller
LEFT JOIN Issue
 ON Caller.caller_id = Issue.caller_id
WHERE Issue.caller_id IS NULL;


8. For each customer show: Company name, contact name, number of calls where 
the number of calls is fewer than 5:

SELECT company_name, 
       con.first_name, con.last_name,
       COUNT(*)
FROM Customer
JOIN Caller
 ON Customer.company_ref = Caller.company_ref
JOIN Issue
 ON Caller.caller_id = Issue.caller_id
JOIN Caller AS con
 ON Customer.contact_id = con.caller_id
GROUP BY company_name, con.first_name, con.last_name
HAVING COUNT(*) < 5;


9. For each shift show the number of staff assigned. Beware that some roles may 
be NULL and that the same person might have been assigned to multiple roles 
(The roles are 'Manager', 'Operator', 'Engineer1', 'Engineer2'):

WITH view1 AS(

SELECT * FROM Shift
JOIN Staff
 ON Shift.manager = Staff.staff_code

UNION

SELECT * FROM Shift
JOIN Staff
 ON Shift.operator = Staff.staff_code

UNION

SELECT * FROM Shift
JOIN Staff
 ON Shift.engineer1 = Staff.staff_code

UNION

SELECT * FROM Shift
JOIN Staff
 ON Shift.engineer2 = Staff.staff_code
)

SELECT DATE_FORMAT(shift_date, '%Y-%m-%d') , shift_type, COUNT(*)
FROM view1
GROUP BY shift_date, shift_type;

*need to create duplicates by unioning


10. Caller 'Harry' claims that the operator who took his most recent call was 
abusive and insulting. Find out who took the call (full name) and when:

SELECT Staff.first_name, 
       Staff.last_name,
       DATE_FORMAT(call_date, '%Y-%m-%d %T')
FROM Caller
JOIN Issue
 ON Caller.caller_id = Issue.caller_id
JOIN Staff
 ON Issue.taken_by = Staff.staff_code
WHERE Caller.first_name = 'Harry'
ORDER BY call_date DESC
LIMIT 1


